{"pageProps":{"layoutProps":{"breadcrumbLinks":[{"title":"Developer","url":"/"},{"title":"Packer","url":"/packer"},{"title":"Guides","url":"/packer/guides","isCurrentPage":false},{"title":"Build Immutable Infrastructure with Packer in CI/CD","url":"/packer/guides/packer-on-cicd"},{"title":"Trigger Terraform Enterprise runs","url":"/packer/guides/packer-on-cicd/trigger-tfe","isCurrentPage":true}],"sidebarNavDataLevels":[{"levelButtonProps":{"levelDownButtonText":"Packer Home"},"menuItems":[{"leadingIconName":"home","title":"HashiCorp Developer","href":"/"},{"leadingIconName":"guide","title":"Tutorials","href":"/tutorials"},{"divider":true},{"heading":"Products"},{"leadingIconName":"hcp","title":"HashiCorp Cloud Platform","href":"/hcp"},{"leadingIconName":"terraform","title":"Terraform","href":"/terraform"},{"leadingIconName":"packer","title":"Packer","href":"/packer"},{"leadingIconName":"consul","title":"Consul","href":"/consul"},{"leadingIconName":"vault","title":"Vault","href":"/vault"},{"leadingIconName":"boundary","title":"Boundary","href":"/boundary"},{"leadingIconName":"nomad","title":"Nomad","href":"/nomad"},{"leadingIconName":"waypoint","title":"Waypoint","href":"/waypoint"},{"leadingIconName":"vagrant","title":"Vagrant","href":"/vagrant"}],"showFilterInput":false,"title":"Main Menu"},{"levelButtonProps":{"levelUpButtonText":"Main Menu","levelDownButtonText":"Previous"},"menuItems":[{"title":"Packer","fullPath":"/packer","theme":"packer"},{"title":"Install","fullPath":"/packer/install"},{"title":"Tutorials","fullPath":"/packer/tutorials"},{"title":"Documentation","fullPath":"/packer/docs"},{"title":"Guides","fullPath":"/packer/guides"},{"title":"Integrations","fullPath":"/packer/integrations"}],"showFilterInput":false,"title":"Packer","visuallyHideTitle":true},{"backToLinkProps":{"text":"Packer Home","href":"/packer"},"levelButtonProps":{"levelUpButtonText":"Packer Home"},"menuItems":[{"title":"Guides","fullPath":"/packer/guides","theme":"packer"},{"title":"Upgrade Your Plugin to use the Packer plugin sdk","path":"1.7-plugin-upgrade","filePath":"../content/guides/1.7-plugin-upgrade.mdx","fullPath":"/packer/guides/1.7-plugin-upgrade","id":"sidebar-nav-item-0"},{"title":"Upgrade Your Template to use Packer init","path":"1.7-template-upgrade","filePath":"../content/guides/1.7-template-upgrade.mdx","fullPath":"/packer/guides/1.7-template-upgrade","id":"sidebar-nav-item-1"},{"title":"HCL guides","routes":[{"title":"Overview","path":"hcl","filePath":"../content/guides/hcl/index.mdx","fullPath":"/packer/guides/hcl","id":"sidebar-nav-item-3"},{"title":"Variables","path":"hcl/variables","filePath":"../content/guides/hcl/variables.mdx","fullPath":"/packer/guides/hcl/variables","id":"sidebar-nav-item-4"},{"title":"Upgrade Packer JSON Template to HCL2","href":"/packer/tutorials/configuration-language/hcl2-upgrade","id":"sidebar-nav-item-5"},{"title":"Making a plugin HCL2 enabled","path":"hcl/component-object-spec","filePath":"../content/guides/hcl/component-object-spec.mdx","fullPath":"/packer/guides/hcl/component-object-spec","id":"sidebar-nav-item-6"}],"id":"sidebar-nav-item-2"},{"title":"Automatic OS Installs","routes":[{"title":"Overview","path":"automatic-operating-system-installs","filePath":"../content/guides/automatic-operating-system-installs/index.mdx","fullPath":"/packer/guides/automatic-operating-system-installs","id":"sidebar-nav-item-8"},{"title":"Unattended Installation for Windows","path":"automatic-operating-system-installs/autounattend_windows","filePath":"../content/guides/automatic-operating-system-installs/autounattend_windows.mdx","fullPath":"/packer/guides/automatic-operating-system-installs/autounattend_windows","id":"sidebar-nav-item-9"},{"title":"Unattended Installation for Debian","path":"automatic-operating-system-installs/preseed_ubuntu","filePath":"../content/guides/automatic-operating-system-installs/preseed_ubuntu.mdx","fullPath":"/packer/guides/automatic-operating-system-installs/preseed_ubuntu","id":"sidebar-nav-item-10"}],"id":"sidebar-nav-item-7"},{"title":"Build Immutable Infrastructure with Packer in CI/CD","routes":[{"title":"Overview","path":"packer-on-cicd","filePath":"../content/guides/packer-on-cicd/index.mdx","fullPath":"/packer/guides/packer-on-cicd","id":"sidebar-nav-item-12"},{"title":"Build Images in CI/CD","path":"packer-on-cicd/build-image-in-cicd","filePath":"../content/guides/packer-on-cicd/build-image-in-cicd.mdx","fullPath":"/packer/guides/packer-on-cicd/build-image-in-cicd","id":"sidebar-nav-item-13"},{"title":"Build a VirtualBox Image with Packer in TeamCity","path":"packer-on-cicd/build-virtualbox-image","filePath":"../content/guides/packer-on-cicd/build-virtualbox-image.mdx","fullPath":"/packer/guides/packer-on-cicd/build-virtualbox-image","id":"sidebar-nav-item-14"},{"title":"Pipelineing Builds","path":"packer-on-cicd/pipelineing-builds","filePath":"../content/guides/packer-on-cicd/pipelineing-builds.mdx","fullPath":"/packer/guides/packer-on-cicd/pipelineing-builds","id":"sidebar-nav-item-15"},{"title":"Trigger Terraform Enterprise runs","path":"packer-on-cicd/trigger-tfe","filePath":"../content/guides/packer-on-cicd/trigger-tfe.mdx","fullPath":"/packer/guides/packer-on-cicd/trigger-tfe","id":"sidebar-nav-item-16"},{"title":"Upload a VirtualBox Image to S3","path":"packer-on-cicd/upload-images-to-artifact","filePath":"../content/guides/packer-on-cicd/upload-images-to-artifact.mdx","fullPath":"/packer/guides/packer-on-cicd/upload-images-to-artifact","id":"sidebar-nav-item-17"}],"id":"sidebar-nav-item-11"}],"title":"Guides","visuallyHideTitle":true}],"mainWidth":"narrow","githubFileUrl":"https://github.com/hashicorp/packer/blob/main/website/../content/guides/packer-on-cicd/trigger-tfe.mdx"},"metadata":{"title":"Trigger Terraform Enterprise runs","description":"Learn how to Terraform Enterprise from your CI/CD pipeline to provision infrastructure.","layout":null},"outlineItems":[{"title":"Create Terraform Enterprise Runs","url":"#create-terraform-enterprise-runs","dataHeapTrack":"toc-list-item-index-0"},{"title":"Create a Terraform Configuration and Workspace","url":"#create-a-terraform-configuration-and-workspace","dataHeapTrack":"toc-list-item-index-1"},{"title":"Include Terraform Enterprise in Your CI Builds","url":"#include-terraform-enterprise-in-your-ci-builds","dataHeapTrack":"toc-list-item-index-2"}],"pageHeading":{"id":"create-terraform-enterprise-runs","title":"Create Terraform Enterprise Runs"},"mdxSource":{"compiledSource":"const layoutProps={};const MDXLayout=\"wrapper\";function MDXContent({components,...props}){return mdx(MDXLayout,{...layoutProps,...props,components:components,mdxType:\"MDXLayout\"},mdx(\"p\",null,`Once an image is built and uploaded to an artifact store, the next step is to\nuse this new image. In some cases the image will be downloaded by the dev team\nand used locally in development, like is often done with VirtualBox images with\nVagrant. In most other cases, the new image will be used to provision new\ninfrastructure.`),mdx(\"p\",null,mdx(\"a\",{parentName:\"p\",\"href\":\"https://www.terraform.io/\"},`Terraform`),` is a community tool that is ideal for\nprovisioning new infrastructure with images generated by Packer, and `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://www.hashicorp.com/products/terraform/\"},`Terraform\nEnterprise`),` is the best way to\nperform automated Terraform runs.`),mdx(\"h2\",{\"id\":\"create-a-terraform-configuration-and-workspace\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#create-a-terraform-configuration-and-workspace\",\"aria-label\":\"create a terraform configuration and workspace permalink\"},`\\xbb`),`Create a Terraform Configuration and Workspace`),mdx(\"p\",null,`The following is a sample Terraform configuration which provisions a new AWS\nEC2 instance. The `,mdx(\"inlineCode\",{parentName:\"p\"},`aws_ami_id`),` is a variable which will be provided when\nrunning `,mdx(\"inlineCode\",{parentName:\"p\"},`terraform plan`),` and `,mdx(\"inlineCode\",{parentName:\"p\"},`terraform apply`),`. This variable references the\nlatest AMI generated with the Packer build in CI/CD.`),mdx(\"pre\",{\"className\":\"language-hcl\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-hcl\"},mdx(\"span\",{parentName:\"code\",\"className\":\"token keyword\"},`variable`,mdx(\"span\",{parentName:\"span\",\"className\":\"token type variable\"},` \"aws_ami_id\" `)),mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`,`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token keyword\"},`provider`,mdx(\"span\",{parentName:\"span\",\"className\":\"token type variable\"},` \"aws\" `)),mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`region`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"us-west-2\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`,`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token keyword\"},`resource `,mdx(\"span\",{parentName:\"span\",\"className\":\"token type variable\"},`\"aws_instance\"`)),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"web\"`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`ami`),`           `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"`,mdx(\"span\",{parentName:\"span\",\"className\":\"token interpolation\"},mdx(\"span\",{parentName:\"span\",\"className\":\"token punctuation\"},`$`),mdx(\"span\",{parentName:\"span\",\"className\":\"token punctuation\"},`{`),mdx(\"span\",{parentName:\"span\",\"className\":\"token keyword\"},`var`),mdx(\"span\",{parentName:\"span\",\"className\":\"token punctuation\"},`.`),mdx(\"span\",{parentName:\"span\",\"className\":\"token type variable\"},`aws_ami_id`),mdx(\"span\",{parentName:\"span\",\"className\":\"token punctuation\"},`}`)),`\"`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`instance_type`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"t2.micro\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`)),mdx(\"p\",null,`Terraform Enterprise should have a workspace with this terraform configuration\nand a placeholder variable `,mdx(\"inlineCode\",{parentName:\"p\"},`aws_ami_id`),`.`),mdx(\"h2\",{\"id\":\"include-terraform-enterprise-in-your-ci-builds\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#include-terraform-enterprise-in-your-ci-builds\",\"aria-label\":\"include terraform enterprise in your ci builds permalink\"},`\\xbb`),`Include Terraform Enterprise in Your CI Builds`),mdx(\"p\",null,`Follow these steps to create a new run from CI/CD after a Packer build is\ncomplete and uploaded.`),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},`Add a new step to the CI/CD pipeline.`),mdx(\"li\",{parentName:\"ol\"},`In the new step add a `,mdx(\"inlineCode\",{parentName:\"li\"},`curl`),` call to update the variables in the workspace\nusing the `,mdx(\"a\",{parentName:\"li\",\"href\":\"/terraform/docs/enterprise/api/variables#update-variables\"},`update variables\nAPI`),`,\nso that Terraform has a reference to the latest image. For the sample\nconfiguration above, the `,mdx(\"inlineCode\",{parentName:\"li\"},`aws_ami_id`),` variable should be updated to the AMI\nID of the latest image.`),mdx(\"li\",{parentName:\"ol\"},`In that same step, add another `,mdx(\"inlineCode\",{parentName:\"li\"},`curl`),` call to `,mdx(\"a\",{parentName:\"li\",\"href\":\"/terraform/docs/enterprise/api/run#create-a-run\"},`create a new run via the\nAPI`),`.\nA run performs a plan and apply on the last configuration version created,\nusing the variables set in the workspace. In the previous step we update the\nvariables, so the new run can be created using the previous configuration\nversion.`)))};MDXContent.isMDXComponent=true;","scope":{"version":"latest"}},"product":{"name":"Packer","slug":"packer","algoliaConfig":{"indexName":"product_PACKER","searchOnlyApiKey":"4e1ea7f4bf4335ac43d9f28463e42148"},"analyticsConfig":{"includedDomains":"packer.io www.packer.io","segmentWriteKey":"AjXdfmTTk1I9q9dfyePuDFHBrz1tCO3l"},"datoToken":"88b4984480dad56295a8aadae6caad","metadata":{"title":"Packer by HashiCorp","description":"Packer helps you create golden images for multiple platforms from a single source configuration.","image":"https://www.packer.io/packer-public/img/og-image.png","icon":[{"href":"/packer-public/_favicon.ico"}]},"alertBannerActive":true,"alertBanner":{"tag":"HashiDays","url":"https://hashicorp.com/conferences/hashidays","text":"One conference. Three cities.","linkText":"Find a city near you","expirationDate":"2024-06-14T00:00:00-08:00"},"version":"1.7.10","basePaths":["docs","guides","intro","downloads"],"rootDocsPaths":[{"iconName":"docs","name":"Documentation","path":"docs"},{"iconName":"guide","name":"Guides","path":"guides"}],"integrationsConfig":{"description":"A curated collection of official, partner, and community Packer Integrations."},"currentRootDocsPath":{"iconName":"guide","name":"Guides","path":"guides"}},"projectName":null,"versions":null},"__N_SSG":true}